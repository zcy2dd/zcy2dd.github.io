<!-- 博文的布局-Layout -->
<!DOCTYPE html>
<html>
<head>
<!-- 引入head标签 -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-sclable=0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="description" content="听说你想看我" />
<meta name="keywords" content="大数据, 程序猿" />
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="stylesheet" href="/assets/css/media.css">
<link rel="stylesheet" href="/assets/css/animate.min.css">
<link rel="stylesheet" href="/assets/css/pygments/pygments_default.css">
<link rel="stylesheet" href="/assets/css/github-markdown.css">
<!-- SNS-icon -->
<script src="//at.alicdn.com/t/font_856428_y9z6nq7zf5.js"></script>
<!-- share.css -->
<link rel="stylesheet" href="/assets/css/share.min.css">
<!-- font -->
<link rel="stylesheet" href="/assets/css/font.css">
<!-- <link href="https://fonts.googleapis.com/css?family=Kaushan+Script|Pacifico|Ubuntu|Roboto+Mono|Source+Sans+Pro" rel="stylesheet"> -->

<!-- Favicon -->
<link href="/assets/profile.jpeg" rel="shortcut icon" />
<link href="/assets/profile.jpeg" rel="apple-touch-icon-precomposed" />
<!-- Android Lolipop Theme Color -->
<!-- <meta name="theme-color" content="#1464FB"> -->
<title>Hadoop集群配置</title>
<!-- 百度统计 -->

<!-- 谷歌分析 -->


<!-- Android Lolipop Theme Color -->
<meta name="theme-color" content=" blue ">
</head>
<body>

<!-- 顶部锚点 -->
<a id="htmlup" name="htmlup"></a>
<!-- 引入博文顶部选项 -->

<header id="post-header" style="background-color:blue;">
  <div class="top-center">
      <div class="logo">
          <a href="/" title="my awesome webtitle" style="color: white;">ZcyOooooop</a>
      </div>
      <nav class="top-nav">
          <ul>
              
                <li><a href="/" style="color: white;">首页</a></li>
              
                <li><a href="/tags.html" style="color: white;">标签</a></li>
              
                <li><a href="/timeline.html" style="color: white;">时间线</a></li>
              
                <li><a href="/about.html" style="color: white;">关于</a></li>
              
                <li><a href="/friendLink.html" style="color: white;">友情链接</a></li>
              
          </ul>
      </nav>
      <div id="top-boot">
        <a href="javascript:;" id="boot1" style="display:block;" onclick="document.getElementById('boot-area').style.display='block';document.getElementById('boot1').style.display='none';document.getElementById('boot2').style.display='block';"><img src="/assets/boot_white.png" alt=""></a>
        <a href="javascript:;" id="boot2" style="display: none;" onclick="document.getElementById('boot-area').style.display='none';document.getElementById('boot1').style.display='block';document.getElementById('boot2').style.display='none';"><img src="/assets/boot_white.png" alt=""></a>
      </div>
  </div>

</header>


<!-- 引入移动下拉选项 -->
<div id="boot-area">
    <ul>
        
          <a href="/"><li>首页</li></a>
        
          <a href="/tags.html"><li>标签</li></a>
        
          <a href="/timeline.html"><li>时间线</li></a>
        
          <a href="/about.html"><li>关于</li></a>
        
          <a href="/friendLink.html"><li>友情链接</li></a>
        
    </ul>
</div>

<!-- 引入博文顶部样式 -->
<!-- 版本一 垃圾 -->
<!-- <div class="wow fadeIn top" data-wow-duration="3.5s" >
    <span class="wow fadeInUp" data-wow-delay="0.2s">Hadoop集群配置</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s">大致介绍了如何配置hadoop</span>
    <span class="wow fadeInUp" data-wow-delay="0.4s">大致介绍了如何配置hadoop</span>
    <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;true</span>
</div> -->

<!-- 版本二 可切换页面 -->

<div class="post-top" style="background-color:blue;">
  <!-- 页面宽度大于800px -->
  <div class="left-area">
    
      <a href="/2018/10/26/%E5%AE%89%E8%A3%85hive.html" class="btn bounceInLeft animated" onmouseover="showLeft();this.style.color='blue';" onmouseout="goneLeft();this.style.color='rgba(0,0,0,.2)';"><</a>
      <div id="left-tab" style="display:none;"><span class="left-san"></span><span class="left-main" style="color:blue;"><sapn class="main">Hive配置安装</sapn></span></div>
    
  </div>
  <div class="post-titlearea">
    <span class="wow fadeInUp" data-wow-delay="0.2s">Hadoop集群配置</span>
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s">大致介绍了如何配置hadoop</span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.4s">大致介绍了如何配置hadoop</span> -->
    <!-- <span class="wow fadeInUp" data-wow-delay="0.6s">作者&nbsp;&nbsp;|&nbsp;&nbsp;true</span> -->
  </div>
  <div class="right-area">
    
      <a href="/2018/05/17/welcome-to-jekyll.html" class="btn bounceInRight self-animated" onmouseover="showRight();this.style.color='blue';" onmouseout="goneRight();this.style.color='rgba(0,0,0,.2)';">></a>
      <div id="right-tab" style="display:none;"><span class="right-san"></span><span class="right-main" style="color:blue;"><sapn class="main">Welcome to Jekyll!</sapn></span></div>
    
  </div>

  <!-- 页面宽度小于800px -->
  <div class="post-changearea">
    
      <a href="/2018/10/26/%E5%AE%89%E8%A3%85hive.html" class="leftchange" style="border-right: 1px solid blue;border-bottom: 2px solid blue;"><span>上一篇<br><br>Hive配置安装</span></a>
    
    
      <a href="/2018/05/17/welcome-to-jekyll.html" class="rightchange" style="border-left: 1px solid blue;border-bottom: 2px solid blue;"><span>下一篇<br><br>Welcome to Jekyll!</span></a>
    
  </div>
</div>


<div class="markdown-body fadeInUp animated">

  
    
      <div class="postpage-subtitle" style="border-left: 8px solid blue; border-right: 8px solid blue">
        hadoop集群配置
      </div>
    
  

  <!-- 文章内容 -->
  <h4 id="1多台机器ssh免密配置">1.多台机器ssh免密配置</h4>

<h5 id="修改用户名">修改用户名</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1.更改hostname
hostnamectl --static set-hostname &lt;主机名&gt;
</code></pre></div></div>

<h5 id="scp传输文件">scp传输文件</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp &lt;文件路径&gt; &lt;目标账号@地址&gt;: 目标路径 
scp /etc/hosts root@hadoop2: /etc/
</code></pre></div></div>

<h5 id="ssh免密登录">ssh免密登录</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 配置公钥
ssh-keygen 
# 配置免密登录
ssh-copy-id &lt;目标ip&gt;
</code></pre></div></div>

<h4 id="2-多台主机时间核对">2. 多台主机时间核对</h4>

<h5 id="所有机器安装ntp">所有机器安装ntp</h5>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install ntp
</code></pre></div></div>
<h5 id="修改主机配置文件">修改主机配置文件</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. 备份配置文件
cp /etc/ntp.conf /etc/ntp.conf.bak
2. 修改主机配置文件
vim /etc/ntp.conf 
# server 0.centos.pool.ntp.org iburst
# server 1.centos.pool.ntp.org iburst
# server 2.centos.pool.ntp.org iburst
# server 3.centos.pool.ntp.org iburst
service 127.127.1.1 #核对时间的一个IP
3.重启ntpd进程，设置开机自启
systemctl restart ntpd
systemctl enable ntpd
</code></pre></div></div>

<h5 id="配置其他主机">配置其他主机</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 1. 校对其他主机时间
ntpdate hadoop1 #与主机校对时间
systemctl start ntpd #启动服务
crontab  # 配置定是脚本

# 2.修改其他主机配置文件
vim /etc/ntp.conf 
# server 0.centos.pool.ntp.org iburst
# server 1.centos.pool.ntp.org iburst
# server 2.centos.pool.ntp.org iburst
# server 3.centos.pool.ntp.org iburst
server 192.168.121.10 #主主机IP

# 3. 在其他主机上设置开机自启

systemctl restart ntpd
systemctl enable ntpd
</code></pre></div></div>

<h4 id="3-hdfs-环境变量配置">3. Hdfs 环境变量配置</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 配置JDK CDH中spark会默认到/usr/java/default目录下去找jdk，所以一般就安装在/usr/java目录下
vim etc/hadoop/hadoop-env.sh
export JAVA_HOME=/usr/java/latest

# 配置文件etc/hadoop/core-site.xml
vim etc/hadoop/core-site.xml
&lt;configuration&gt;
 &lt;property&gt;
  &lt;name&gt;fs.defaultFS&lt;/name&gt;
  &lt;value&gt;hdfs://hadoop1:9000&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
  &lt;value&gt;/usr/local/hadoop-2.6.0/data/tmp&lt;/value&gt;
 &lt;/property&gt;
&lt;/configuration&gt;

# 配置文件vim etc/hadoop/hdfs-site.xml
&lt;configuration&gt;
 &lt;property&gt;
  &lt;name&gt;dfs.replication&lt;/name&gt;
  &lt;value&gt;1&lt;/value&gt;
 &lt;/property&gt;
&lt;/configuration&gt;
# python操作hdfs时需要获取权限
&lt;property&gt; 
	&lt;name&gt;dfs.permissions&lt;/name&gt; 
&lt;value&gt;false&lt;/value&gt; 
## 指定secondarynamenode节点
&lt;property&gt;
	&lt;name&gt;dfs.namenode.secondary.http-address&lt;/name&gt;
	&lt;value&gt;节点地址:50090&lt;/value&gt;
&lt;/property&gt;
# 配置下Hadoop的环境变量（略

# NameNode格式化  
hdfs namenode -format

# hdfs 的web监控端口50070
# 服务启动
hadoop-daemon.sh start namenode
hadoop-daemon.sh start datanode

# 创建文件夹
hdfs dfs -mkdir /test
# 上传文件
hdfs dfs -put /etc/profile /file
</code></pre></div></div>

<h4 id="4-配置yarn">4. 配置Yarn</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 配置文件etc/hadoop/mapred-site.xml
vim etc/hadoop/mapred-site.xml
&lt;configuration&gt;
 &lt;property&gt;
  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
  &lt;value&gt;yarn&lt;/value&gt;
 &lt;/property&gt;
&lt;/configuration&gt;

# 配置文件etc/hadoop/yarn-site.xml
&lt;property&gt;
 &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
 &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
 &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
 &lt;value&gt;hadoop1&lt;/value&gt;
&lt;/property&gt;

# slaves设置
vim etc/hadoop/slaves
本机ip

# 启动yarn
sh start-yarn.sh

#启动后的Web端口为8088
</code></pre></div></div>

<h4 id="5-配置zookeeper">5. 配置ZooKeeper</h4>

<ol>
  <li>上传文件（zookeeper.tar.gz</li>
  <li>解压至指定文件夹</li>
  <li>创建data/zkData文件夹</li>
  <li>修改配置文件</li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    cd conf
    cp zoo_sample.cfg  zoo.cfg
    vim zoo.cfg
    # 修改文件目录
    datadir=/usr/local/zookeeper/data/zkData
    # 配置各节点以及端口信息(选举节点：通信节点)
    server.1=hadoop1:2888:3888
    server.2=hadoop2:2888:3888
    server.3=hadoop3:2888:3888
</code></pre></div></div>
<ol>
  <li>将zookeeper整个文件夹发送到其他节点</li>
  <li>在data/zkData文件夹下，创建myid
    <ul>
      <li>myid里面指定当前节点的id</li>
      <li>即hadoop1 里面的内容为1</li>
      <li>hadoop2里面的内容为2</li>
    </ul>
  </li>
  <li>修改环境部变量（选</li>
  <li>开启服务
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 开启服务
bin/zkServer.sh start
# 查看角色分配以及当前状态
bin/zkServer.sh status
# 进入虚拟文件系统的shell
bin/zkCli.sh
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="6-配置hadoop-ha">6. 配置Hadoop-HA</h4>

<h5 id="hdfs-sitexml配置">hdfs-site.xml配置</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim etc/hadoop/hdfs-site.xml
&lt;configuration&gt;
 &lt;property&gt;
 # 对整个文件系统的一个统称
  &lt;name&gt;dfs.nameservices&lt;/name&gt;
  &lt;value&gt;ns1&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 指定这个文件系统的namenode有哪些
  &lt;name&gt;dfs.ha.namenodes.ns1&lt;/name&gt;
  &lt;value&gt;nn1,nn2&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 指定nn1是哪个
  &lt;name&gt;dfs.namenode.rpc-address.ns1.nn1&lt;/name&gt;
  &lt;value&gt;hadoop1:8020&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 指定nn2 是哪个
  &lt;name&gt;dfs.namenode.rpc-address.ns1.nn2&lt;/name&gt;
  &lt;value&gt;hadoop2:8020&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 指定nn1 的访问端口
  &lt;name&gt;dfs.namenode.http-address.ns1.nn1&lt;/name&gt;
  &lt;value&gt;hadoop1:50070&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 指定nn2的访问端口
  &lt;name&gt;dfs.namenode.http-address.ns1.nn2&lt;/name&gt;
  &lt;value&gt;hadoop2:50070&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 共享在journalnode上的共享端口
  &lt;name&gt;dfs.namenode.shared.edits.dir&lt;/name&gt;
  &lt;value&gt;qjournal://hadoop1:8485;hadoop2:8485;hadoop3:8485/ns1&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 配置eidts在journalnode上的保存地址
  &lt;name&gt;dfs.journalnode.eidts.dir&lt;/name&gt;
  &lt;value&gt;/usr/local/hadoop-2.6.0/data/dfs/jn&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
 # 配置proxy代理客户端
  &lt;name&gt;dfs.client.failover.proxy.provide.nsl&lt;/name&gt;
  &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;
 &lt;/property&gt;
</code></pre></div></div>

<h5 id="配置core-sitexml">配置core-site.xml</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 配置两个namennode的隔离策略
# sshfence方式
# 使用这种方式，必须实现ssh无密码登录

vim etc/hadoop/core-site.xml

&lt;configuration&gt;
 &lt;property&gt;
  &lt;name&gt;dfs.ha.fencing.methods&lt;/name&gt;
  &lt;value&gt;sshfence&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
  &lt;name&gt;dfs.ha.fencing.ssh.private-key-files&lt;/name&gt;
  &lt;value&gt;/root/.ssh/id_rsa&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
  &lt;name&gt;fs.defaultFS&lt;/name&gt;
  &lt;value&gt;hdfs://ns1&lt;/value&gt;
 &lt;/property&gt;
 &lt;property&gt;
  &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
  &lt;value&gt;/usr/local/hadoop-2.6.0/data/tmp&lt;/value&gt;
 &lt;/property&gt;
&lt;/configuration&gt;

</code></pre></div></div>
<h5 id="启动集群">启动集群</h5>

<ul>
  <li>关闭所有其他相关的进程</li>
  <li>启动所有的journalnode
    <ul>
      <li>hadoop-daemon.sh start journalnode</li>
    </ul>
  </li>
  <li>nn1 格式化并启动
    <ul>
      <li>hdfs namenode -formate</li>
      <li>hadoop-daemon.sh start namenode</li>
    </ul>
  </li>
  <li>在nn2上同步nn1的元数据信息
    <ul>
      <li>hdfs namenode -bootstrapStandby</li>
    </ul>
  </li>
  <li>启动nn2
-hadoop-daemon.sh start namenode</li>
  <li>启动所有datanode
    <ul>
      <li>hadoop-daemon.sh start datanode</li>
    </ul>
  </li>
  <li>调整一个nameno为active
    <ul>
      <li>hdfs haadmin -help (查看相关命令)</li>
      <li>hdfs haadmin -transitionToActive nn1(将nn1调整为active)</li>
    </ul>
  </li>
</ul>

<h5 id="借助zookeeper配置自动故障转移">借助zookeeper，配置自动故障转移</h5>

<ol>
  <li>启动时都是standby，选取一个为active</li>
  <li>监控 ZKFC（它负责整体的故障转移控制</li>
</ol>

<p>配置</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 打开自动故障转移
# hdfs-site.xml:
&lt;property&gt;
	&lt;name&gt;dfs.ha.automatic-failover.enabled&lt;/name&gt;
	&lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;

# core-site.xml:
# 添加zookeeper的服务
&lt;property&gt;
	&lt;name&gt;ha.zookeeper.quorum&lt;/name&gt;
	&lt;value&gt;hadoop1:2181,hadoop2:2181,hadoop3:2181&lt;/value&gt;
&lt;/property&gt;
</code></pre></div></div>

<h5 id="启动">启动</h5>

<ol>
  <li>保证所有节点文件相同，关闭所有hdfs服务</li>
  <li>启动zookeeper集群
    <ul>
      <li>zkServer.sh start</li>
    </ul>
  </li>
  <li>初始化HA在zookeeper中的状态
    <ul>
      <li>hdfs zkfc -formatZK -force</li>
    </ul>
  </li>
  <li>启动hdfs服务
    <ul>
      <li>start-hdfs.sh</li>
      <li>如果直接一起启动出现通信错误，造成namenode停止，则需要先启动journalnode，再启动其他</li>
    </ul>
  </li>
  <li>namenode节点启动zkfc服务
    <ul>
      <li>hadoop-daemon.sh start zkfc</li>
    </ul>
  </li>
</ol>

  <!-- 引入share模块 -->
  
  <div class="social-share-wrapper">
    <div class="social-share"></div>
  </div>


<!-- share.js -->
<script src="/assets/js/social-share.min.js"></script>
<script>
  socialShare('.social-share', {
    sites: [
      
        'qq'
        ,
        
      
        'wechat'
        ,
        
      
        'weibo'
        ,
        
      
        'twitter'
        ,
        
      
        'facebook'
        
      
    ],
    wechatQrcodeTitle: "分享到微信朋友圈",
    wechatQrcodeHelper: '期待在朋友圈见到这篇文章'
  });
</script>

</div>

<!-- 底部锚点 -->
<a id="htmldown" name="htmldown"></a>
<!-- 引入评论模块 -->






<!-- 引入goto模块 -->
<div class="bounceInRight animated go">
  <a title="顶部切换页面" class="gototop" href="#htmlup" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Top
    </div>
  </a>
  <a title="底部有评论哦" class="gotobottom" href="#htmldown" target="_self">
    <div class="box" style="font-family:'ffad_matroregular';">
        Foot
    </div>
  </a>
</div>

<!-- 引入页面底部模块 -->
<footer id="bottom">
  <br>
  <span>Zcy ©
  
  
  2018
  <br>
  Powered by <a href="https://www.jekyll.com.cn/">Jekyll</a> | <a href="https://github.com/xukimseven/HardCandy-Jekyll">HardCandy-Jekyll</a></span>
</footer>


<!-- 引用wow.js的动画效果 -->
<script src="/assets/js/wow.js"></script>
<script>
    var wow = new WOW({
        boxClass: 'wow',
        animateClass: 'animated',
        // offset: 600,
        mobile: true,
        live: true
    });
    wow.init();
</script>
<!-- 页面刷新回到顶部 -->
<script>
    window.onbeforeunload = function(){
        //刷新后页面自动回到顶部
        document.documentElement.scrollTop = 0;  //ie下
        document.body.scrollTop = 0;  //非ie
    }
</script>
<script src="/assets/js/main.js"></script>
</body>
</html>
